services:
  # MongoDB Service
  db:
    image: mongo:latest
    restart: unless-stopped
    volumes:
      - mongodb-data:/data/db
    ports:
      - "27017:27017" # Expose MongoDB for access
    environment:
      MONGO_INITDB_ROOT_USERNAME: root
      MONGO_INITDB_ROOT_PASSWORD: password

  # Combined Server-side (Node.js) and Client-side (Angular served by NGINX)
  app:
    build:
      context: . # Points to the root directory where the combined Dockerfile is located
      dockerfile: Dockerfile
    volumes:
      - ./client:/client # Adjusted to point to the client folder (for Angular app)
      - ./server:/server # Adjusted to point to the server folder (for Node.js app)
    ports:
      - "80:80" # Expose NGINX (Angular app) on port 80
      - "3000:3000" # Expose Node.js API on port 3000
    depends_on:
      - db
    environment:
      - MONGO_URL=mongodb://db:27017/chatappDB
    networks:
      - frontend

volumes:
  mongodb-data:

networks:
  frontend:
# version: '3.8'

# services:
#   app:
#     build:
#       context: .
#       dockerfile: Dockerfile
#     volumes:
#       - ../..:/workspaces:cached

#     # Overrides default command so things don't shut down after the process ends.
#     command: sleep infinity

#     # Runs app on the same network as the database container, allows "forwardPorts" in devcontainer.json function.
#     network_mode: service:db

#     # Use "forwardPorts" in **devcontainer.json** to forward an app port locally.
#     # (Adding the "ports" property to this file will not forward from a Codespace.)

#   db:
#     image: mongo:latest
#     restart: unless-stopped
#     volumes:
#       - mongodb-data:/data/db

#     # Uncomment to change startup options
#     # environment:
#     #  MONGO_INITDB_ROOT_USERNAME: root
#     #  MONGO_INITDB_ROOT_PASSWORD: example
#     #  MONGO_INITDB_DATABASE: your-database-here

#     # Add "forwardPorts": ["27017"] to **devcontainer.json** to forward MongoDB locally.
#     # (Adding the "ports" property to this file will not forward from a Codespace.)

# volumes:
#   mongodb-data:
